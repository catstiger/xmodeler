<!DOCTYPE html>
<html lang="zh_cn">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=Edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="UTF-8">

<!-- 最新 Bootstrap 核心 CSS 文件 -->
<link rel="stylesheet" href="http://cdn.bootcss.com/twitter-bootstrap/3.0.3/css/bootstrap.min.css">
<!-- jQuery文件。务必在bootstrap.min.js 之前引入 -->
<script src="http://cdn.bootcss.com/jquery/1.10.2/jquery.min.js"></script>
<!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
<script src="http://cdn.bootcss.com/twitter-bootstrap/3.0.3/js/bootstrap.min.js"></script>

<!--[if lt IE 9]><script src="../docs-assets/js/ie8-responsive-file-warning.js"></script><![endif]-->

<!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!--[if lt IE 9]>
  <script src="http://cdn.bootcss.com/html5shiv/3.7.0/html5shiv.min.js"></script>
  <script src="http://cdn.bootcss.com/respond.js/1.3.0/respond.min.js"></script>
<![endif]-->
<link rel="shortcut icon" href="images/logo16.png" type="image/x-icon" />

<link rel="stylesheet" href="css/guide.css">
<link rel="stylesheet" href="js/code/codemirror.css">
<title>XModeler Documentaion</title>

<style>
body{font-family:"ff-tisa-web-pro-1","ff-tisa-web-pro-2","Lucida Grande","Helvetica Neue",Helvetica,Arial,"Hiragino Sans GB","Hiragino Sans GB W3","WenQuanYi Micro Hei",sans-serif;}
h1, .h1, h2, .h2, h3, .h3, h4, .h4, .lead {font-family:"ff-tisa-web-pro-1","ff-tisa-web-pro-2","Lucida Grande","Helvetica Neue",Helvetica,Arial,"Hiragino Sans GB","Hiragino Sans GB W3","Microsoft YaHei UI","Microsoft YaHei","WenQuanYi Micro Hei",sans-serif;}
pre code { background: transparent; }
@media (min-width: 768px) {
    .bs-docs-home .bs-social, 
    .bs-docs-home .bs-masthead-links {
      margin-left: 0;
    }
}

h2 {
  font-size:18px;
}

.bs-docs-section p {
	line-height: 2;
}

.bs-docs-section p.lead {
	line-height: 1.4;
}

.CodeMirror {
    height : auto !important;
}

.cm-s-default .cm-comment {color: #009900;}
.cm-s-default .cm-tag {color: #d820a1;}

ul li b {
  color:#428BCA;
}
</style>

</head>
<body class="bs-docs-home" cz-shortcut-listen="true">
  <a class="sr-only" href="#content">Skip to main content</a>

  <!-- Docs master nav -->
  <header class="navbar navbar-inverse navbar-fixed-top bs-docs-nav" role="banner">
  <div class="container">
    <div class="navbar-header">
      <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".bs-navbar-collapse">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a href="index.html" class="navbar-brand"><img src="images/logo32.png" style="width:24px;"/>&nbsp;XModeler</a>
    </div>
    <nav class="collapse navbar-collapse bs-navbar-collapse" role="navigation">
      <ul class="nav navbar-nav">
        <li>
          <a href="getting-started.html">起步</a>
        </li>
        <li class="active" >
          <a href="activiti.html">Activiti BPMN扩展</a>
        </li>
        <li>
          <a href="dev-guide.html">开发手册</a>
        </li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
          <a href="about">关于</a>
        </li>
      </ul>
    </nav>
  </div>
</header>

<!-- Docs page layout -->
	<div class="bs-header" id="content">
		<div class="container">
			<h1>Activiti BPMN扩展</h1>
			<p>Activiti是一个轻量级工作流程和业务流程引擎，它基于Java可以在任何平台下运行。Activiti提供了Eclipse和Web建模工具，但是它很难扩展和整合。
			因此，我们在XModeler基础引擎上进行了扩展，使得任何基于Java的应用可以方便的整合Activity BPMN建模工具。
			</p>
			<h2>Features</h2>
			<ul style="font-size:14px;">
			    <li>支持开始事件(StartEvent)、结束事件(End Event)、任务(Task)、子流程(Sub Process)、顺序流(Sequence Flow)、计时器事件(Timer Event)。</li>
			    <li>可以方便的进行扩展，以支持其他类型的节点。</li>
			    <li>支持上下文菜单操作和菜单操作，使用键盘可以移动节点或者删除节点。</li>
			    <li>支持节点选择，在节点选择事件中提供被选中节点的全部属性。</li>
			    <li>支持从服务器端加载Json数据（符合Activiti Json Converter）。</li>
			    <li>将绘制的流程图转换为符合Activity Json Converter格式的Json，并提交至服务器端。</li>
			    <li>支持各种节点的各种属性，包括表单绑定等。您可以自由扩展这些属性。</li>
			    <li>只读(read-only)模式，用于查看流程的运行状态，在只读模式下不可对流程图进行编辑，但是仍然能够响应一些事件。</li>
			    <li>静默(mute)模式，类似于只读模式，但是不响应事件。</li>
			</ul>
		</div>
	</div>
	<div class="container bs-docs-container">
		<div class="row">
			<div class="col-md-3">
				<div class="bs-sidebar hidden-print affix-top" role="complementary">
					<ul class="nav bs-sidenav">

						<li><a href="#start">开始使用</a>
						<li><a href="#custom-toolbar">定制工具条</a>
						<li><a href="#customize">定制</a>
						<li><a href="#load-from-server">从服务器端加载流程图</a></li>
						<li><a href="#post-to-server">向服务器端提交流程图</a></li>
						<li><a href="#events">事件响应</a></li>
						<li><a href="#node-properties">节点属性</a></li>
					</ul>
				</div>
			</div>
			<div class="col-md-9" role="main">
			<div class="bs-docs-section">
			    <div class="page-header">
			      <h1 id="start">开始使用</h1>
			    </div>
			    <p>
			    我们在<a href="getting-started.html" target="_blank">起步</a>已经介绍了XModeler Activiti扩展的基本使用方法，
			    这里我们将详细的进行描述。
			    </p>
			    
			    <p>首先在您的页面中加入XModeler及其依赖。</p>
			    <div class="highlight">
			    <textarea model="htmlmixed">
<!--[if lte IE 8]>
<script type="text/javascript" src="../lib/ie/excanvas.js"></script>
<script type="text/javascript" src="../lib/ie/canvas.text.js"></script>
<script type="text/javascript" src="../lib/ie/faces/optimer-normal-normal.js"></script>
<![endif]-->

<link rel="stylesheet" href="http://cdn.bootcss.com/twitter-bootstrap/3.0.3/css/bootstrap.min.css">
<script src="http://cdn.bootcss.com/jquery/1.10.2/jquery.min.js"></script>
<script src="http://cdn.bootcss.com/twitter-bootstrap/3.0.3/js/bootstrap.min.js"></script>

<script type="text/javascript" src="../src/base/Utils.js"></script>
<script type="text/javascript" src="../lib/quark.base-1.0.0.js"></script>

<script type="text/javascript" src="../xmodeler.engine.min.js"></script>
<script type="text/javascript" src="../xmodeler.activity.min.js"></script>

<script type="text/javascript" src="../src/impl/locale/bpmn-lang-zh_CN.js"></script>
<link rel="stylesheet" type="text/css" href="../themes/default/css/style.css">
<script type="text/javascript" src="../themes/default/Icons.js"></script>
			    </textarea>
			    </div>
			    <br>
			    
			    <p>声明一个DIV（或者其他DOM），作为XModeler的容器。</p>
			    <div class="highlight">
			    <textarea  mode="htmlmixed">
<div  id="bpm" class="canvas" style="height:360px;"></div>
			     </textarea>
			     </div>
			    </div>
			    <br>
			    <p>最后在Onload事件中创建Bpmn对象。</p>
			    <div class="highlight">
			    <textarea mode="javascript">
$(function() {
	var bpm = new ActivityEngine({ //使用Activity Bpmn实现
		selector : '#bpm' //符合css selector规范
	});
});
			    </textarea>
			    </div>
			    <br>
			    <p>
			    此时，XModeler Activiti流程图对象已经创建完成，页面上会看到一个由浅黄色网格作为背景（可以修改style.css修改这个样式）的区域，这就是绘图区。您可以通过
			    上下文菜单绘制流程图。
			    </p>
			    <p>
			    <img src="images/bpmn-1.jpg">
			    </p>
			    
			    <div class="page-header">
			      <h1 id="custom-toolbar">定制工具条</h1>
			    </div>
			    <p>
			    XModeler提供的上下文菜单使用十分方便，但是在某些情况下我们仍然需要一个工具条。例如，如果您在一个子流程中加入某些节点，就必须使用工具条了。下面的例子中，
			    我们采用Bootstrap的导航条作为工具条。<br>
			    首先，您要定义工具条：
			    </p>
			    <div class="highlight">
			    <textarea  mode="htmlmixed">
<nav class="collapse navbar-collapse bs-navbar-collapse" role="navigation">
<ul class="nav navbar-nav">
        <li>
        <a class='bpmn-btn' id="addStartEvent">开始事件</a>
        </li>
        <li>
		<a class='bpmn-btn' id="addEndEvent">结束事件</a>
		</li>
        <li>
		<a class='bpmn-btn' id="addUserTask">手工任务</a>
		</li>
        <li>
		<a class='bpmn-btn' id="addServiceTask">服务任务</a>
		</li>
        <li>
		<a class='bpmn-btn' id="addScriptTask">脚本任务</a>
		</li>
        <li>
		<a class='bpmn-btn' id="addParallelGateway">平行网关</a>
		</li>
        <li>
		<a class='bpmn-btn' id="addExclusiveGateway">排他网关</a>
		</li>
        <li>
		<a class='bpmn-btn' id="addSubProcess">子流程</a>
		</li>
        <li>
		<a class='bpmn-btn' id="addTimerEvent">定时边界事件</a>
		</li>
        <li>
		<a class='bpmn-btn' id="addConnection">顺序流</a>
   </ul>
 </nav>
			    </textarea>
			    </div>
			    <p>
			    然后，我们为菜单绑定事件。
			    </p>
			    <div class="highlight">
			    <textarea  mode="javascript">
$('.bpmn-btn').each(function() {//为每一个工具条按钮绑定click事件
    $(this).click(function(e) {
	    bpm.setAction(this.id); //设置BPMN对象当前的活动，这个活动的名字和工具条按钮的ID是一致的。
	    e.preventDefault();
	});
});
	            </textarea>
	            </div>
			    <p>
			    每一个按钮事件都非常简单，实际上，工具条按钮点击的时候只是为XModeler设定了活动状态，这些活动状态包括：
			    <ul>
			       <li>addStartEvent：添加一个开始事件。</li>
			       <li>addEndEvent：添加一个结束事件。</li>
			       <li>addUserTask：添加用户任务。</li>
			       <li>addServiceTask：添加服务任务。</li>
			       <li>addScriptTask：添加脚本任务。</li>
			       <li>addParallelGateway：添加平行网关。</li>
			       <li>addExclusiveGateway：添加互斥网关。</li>
			       <li>addSubProcess：添加子流程。</li>
			       <li>addTimerEvent：添加计时器事件。</li>
			       <li>addConnection：开始绘制连接线，当进入绘制连接线状态时，首先点击连接线的开始节点，然后点击连接线的终止节点。</li>
			    </ul>
			    当使用工具条的时候，每次添加一个节点，XModeler的活动状态会重置，因此，如果您需要继续添加节点，就需要再次点击按钮。
			    </p>
			    
			    <div class="page-header">
			      <h1 id="customize">定制</h1>
			    </div>
			    <h2>图标</h2>
			    <p>
			      在XModeler Activiti BPMN所绘制的图形上，都有一些图标，这些图标定义在themes/default/images下，XModeler通过引用Icons对象使用
			      这些图标。因此如果修改图标，您需要修改themes/default/Icons.js文件。<span style="color:#aa0000;">特别需要注意的是，Icons对象中
			      的图标路径都是相对于<b>引用XModeler对象的页面</b>，如果您希望在任何页面都可以正常显示图标，那么需要将Icons中的路径改为绝对路径，这样才能确保找到这些图标。</span>
			      <div class="highlight">
			      <textarea  mode="javascript">
var Icons = function() {
	
};
//绝对路径可以保证在任何页面都可以正确显示图标
Icons.startEvent = '/xmodeler/themes/default/images/start.png';
Icons.endEvent = '/xmodeler/themes/default/images/end.png';
Icons.errorEndEvent = '/xmodeler/themes/default/images/error-end.png';
Icons.timerEvent = '/xmodeler/themes/default/images/timer_event.png';
Icons.exclusiveGateway = '/xmodeler/themes/default/images/exclusive-gateway.png';
Icons.parallelGateway = '/xmodeler/themes/default/images/parallel_gateway.png';
Icons.userTask = '/xmodeler/themes/default/images/user.png';
Icons.scriptTask = '/xmodeler/themes/default/images/script.png';
Icons.serviceTask = '/xmodeler/themes/default/images/service.png';
Icons.plus = '/xmodeler/themes/default/images/plus.png';
Icons.minus = '/xmodeler/themes/default/images/minus.png';
Icons.plug = '/xmodeler/themes/default/images/plug_blue.gif';
Icons.plugDisable = '/xmodeler/themes/default/images/plug_disable.gif';
	            </textarea>
	            </div>
			    </p>
			    <p>
			      <h2>国际化</h2>
			    </p>
			    <p>
			      所谓的国际化，主要是定义各种节点的缺省名字(name)。
			      在src/impl/locale定义了两种语言，分别是中文和英文，如果您需要支持其他语言<b>或者您不喜欢现有语言中的那些名字</b>，可以在此基础上进行修改。
			    </p>
			    
			    
			    
			    
			    <div class="page-header">
			      <h1 id="load-from-server">从服务器端加载流程图</h1>
			    </div>
			    <p>
			    XModeler是一个纯JavaScript框架，不包含任何服务器端代码。但是，因为涉及到了Activiti，因此，需要将XModeler Activit扩展与Activiti服务器端整合的方法
			    进行详细的介绍。这里只是描述如何将Activiti Bpmn Model 与XModeler Json模型互相转换，并未涉及任何Activiti的概念和使用方法。
			    </p>
			    <p>
			    首先介绍如何将Activiti Bpmn Model转换为XModeler Json所需的Json，Activiti提供了BpmnModel对象，用于描述一个流程，这个对象可以根据processDefinitionId获得。
			    在服务器端我们只需要将BpmnModel对象转换为Json，并返回给浏览器就可以了。BpmnModel是一个非常复杂的对象，转换过程中会出现递归死循环的情况，需要程序员
			    认真处理。
			    </p>
			    <div class="highlight">
			    <textarea mode="javascript">
/**
   * 根据Process Definition Id获取BpmnModel的实例
   */
  public BpmnModel bpmnModelByProcDefId(String processDefinitionId) throws Exception {
    BpmnModel bpmnModel = processEngine.getRepositoryService().getBpmnModel(processDefinitionId);
    //上面的BpmnModel对象并未包含任何关于节点类型的数据，因此，我们需要解析部署XML文件，找到节点类型。
    String deployXml = getDeploymentXML(processDefinitionId);

    Map<String, String> namespaces = new HashMap<String, String>();
    namespaces.put("MODEL", "http://www.omg.org/spec/BPMN/20100524/MODEL");

    SAXReader saxReader = new SAXReader();
    saxReader.getDocumentFactory().setXPathNamespaceURIs(namespaces);
    Document doc = saxReader.read(new StringReader(deployXml));

    List nodes = doc.selectNodes("//MODEL:process/*");
    for (Iterator itr = nodes.iterator(); itr.hasNext();) {
      Element element = (Element) itr.next();
      extractItemDefinition(element, bpmnModel);
    }
    return bpmnModel;
  }
  
  /**
   * 得到部署的流程的XML文本
   */
  private String getDeploymentXML(String processDefinitionId) throws Exception {
    BpmnModel bpmnModel = processEngine.getRepositoryService().getBpmnModel(processDefinitionId);
    byte[] xml = new BpmnXMLConverter().convertToXML(bpmnModel, "UTF-8");
    String deployXml = new String(xml, "UTF-8");
    //convertToXML方法有BUG，生成的XML的namespace和元素属性是重复的，因此——
    //修正XML中重复的namespace和属性，因为我的方法难登大雅，就不现了。
    return fixXml(deployXml);
  }
  
  /**
   * 从Element对象中，提取对象类型，RepositoryService不能提供各个节点的类型，这里搞定
   */
  private void extractItemDefinition(Element element, BpmnModel bpmnModel) {
    Attribute idAttr = element.attribute("id");
    if (idAttr != null && StringUtils.isNotBlank(idAttr.getValue())) {
      ItemDefinition itemDefinition = new ItemDefinition();
      itemDefinition.setId(idAttr.getValue());
      String name = element.getName().substring(0, 1).toUpperCase() + element.getName().substring(1);
      itemDefinition.setItemKind(name);
      bpmnModel.addItemDefinition(idAttr.getValue(), itemDefinition);
      //处理子流程
      if (StringUtils.equals(BpmnXMLConstants.ELEMENT_SUBPROCESS, element.getName())) {
        for (Iterator eleItr = element.elementIterator(); eleItr.hasNext();) {
          Element subEle = (Element) eleItr.next();
          extractItemDefinition(subEle, bpmnModel);
        }
      }
    }
  }
  
			    </textarea>
			    </div>
			    <p>
			    得到BpmnModel对象之后，就可以使用任意Java MVC框架结合JacksonJson之类的工具，将它转换为Json数据，并返回给浏览器。需要注意的是
			    BpmnModel对象涉及大量的循环引用，转换的时候应避免死循环。
			    </p>
			    <p>
			    在JavaScript里面，我们调用服务器端的上述服务，就可以加载流程图了。
			    </p>
			    <div class="highlight">
			    <textarea mode="javascript">
/**
* 从服务器端加载流程图
* @param activityEngine ActivityEngine对象，通过new ActivityEngine创建。
* @param processDefinitionId  流程定义ID，请参考Activiti相关文档。
*/
function loadBpmn(activityEngine, processDefinitionId) {
	var activitiAdapter = new ActivityAdapter();
	activitiAdapter.load(acitivityEngine, {
	  processDefinitionId : processDefinitionId,
	  queryUrl : 'URL_TO_LOAD_BPMN_JSON', //可以访问到BpmnModel Json的URL
	  /*
	  * 加载成功后的回调函数
	  * @param bpmnModel 符合Activity Json Converter要求的对象，注意，这与服务器端返回的对象是不同的。
	  */
	  loadSuccess : function(bpmnModel) { 
	  },
	  loadFailed : function() {
		alert('流程加载失败！');
	  }
	});
}
			    </textarea>
			    </div>
			    <div class="page-header">
			      <h1 id="post-to-server">向服务器端提交流程图</h1>
			    </div>
			    <p>
			    与加载BPMN相反，提交流程图是将客户端提交的Json数据转换为BpmnModel对象，并部署。BpmnModel对象十分复杂，幸好Activiti提供了BpmnJsonConverter类，
			    可以方便的将Json数据转换为BpmnModel对象。
			    </p>
			    <div class="highlight">
			    <textarea mode="javascript">
  /**
   * 部署JSON格式的Activiti流程定义
   * 
   * @param name  流程名称
   * @param json JSON文本
   * @return return Instance of Deployment
   */
  public Deployment deployJson(String name, String json) throws Exception {
    //转换为BpmnModel对象
    JsonNode modelNode = new ObjectMapper().readTree(json);
    BpmnModel bpmnModel = new BpmnJsonConverter().convertToBpmnModel(modelNode);
    //得到部署的XML
    byte[] xml = new BpmnXMLConverter().convertToXML(bpmnModel);
    String deployXml = new String(xml, "UTF-8");
    //部署
    DeploymentBuilder deploymentBuilder = processEngine.getRepositoryService().createDeployment();
    deploymentBuilder.name(name).addString(name + ".bpmn", xml);
    return deploymentBuilder.deploy();
  }
			    </textarea>
			    </div>
			    <p>
			    上述代码可以在任意的Java MVC框架中调用，下面我们看Javascript代码。
			    </p>
			    <div class="highlight">
			    <textarea mode="javascript">
//activityEngine通过前面的new ActivityEngine({selector : #some_dom});创建
activityEngine.raw.process_id = "process_key"; //Process Id,即Process Key，是必须的。
activityEngine.raw.name = "process_name"; //Process Name，部署时的资源名称
var bpmnObject = activityEngine.rawObject();
$.ajax({
		url : 'URL_TO_DEPLOY_SERVICE',
		params : {
			text : $.stringify(bpmnObject), //text是Http Request参数名称，可以任意
			name : activityEngine.raw.name
		},
		success : function(resp) {
			//部署成功
		},
		failure : function() {
			//部署失败
		}
});
			    </textarea>
			    </div>
			    <div class="page-header">
			      <h1 id="#events">事件响应</h1>
			    </div>
			    
			    <h2>click事件</h2>
			    <p>
			    click事件是最常用的事件，当点击XModeler绘图区域的时候响应。如果此时点击了绘图区域中的某个元素，
			    则事件响应函数的参数就是这个元素的对象。<br>
			    参数列表：
			    </p>
			    <ul>
			      <li>event，HTML事件对象。</li>
			      <li>selections，如果没有选择任何元素，则为undefined；如果选择多个对象，则为数组；如果选择一个对象，则为该对象。</li>
			    </ul>
			    <div class="highlight">
			    <textarea mode="javascript">
var activityEngine = new ActivityEngine({
	selector : $("#some_id").eq(),
	fit : true,
	raw : null,
	listeners : {
	  click : function(event, selections) {
	    console.log(selections);
	  }
	}
});
			    </textarea>
			    </div>
			    
			    <div class="page-header">
			      <h1 id="node-properties">节点属性</h1>
			    </div>
			    <p>
			    XModeler-Activity的每一个元素，包括XModoler-Activity本身，都包括3个主要属性。（其实还有很多属性，但是作为流程开发的属性这3个就够了。）
			    </p>
			    <h2>id</h2>
			    <p>
			    每一个节点都有一个id属性，它是唯一的，当新增一个节点的时候，XModeler会自动为该节点分配一个id。一般来说，没有必要修改这个属性。
			    </p>
			    <h2>name</h2>
			    <p>
			    每一个节点都有一个name属性，这个属性也是Activity节点的name。
			    </p>
			    <h2>raw</h2>
			    <p>
			    哇，这个属性对应着Actvity每一个节点的属性，也就是说，每一个节点的raw属性都是一个对象，而且各不相同，这个对象的属性是与Activiti Json Converter一致的。
			    在各个节点的实现类中，都提供一个rawObject函数，在这个函数中，定义了raw属性的格式，下面我们一个一个的介绍这些节点的属性(以及如何获取和设置这些属性)。
			    </p>
			    
			   <p style="color:#c00;font-weight:bold;">如何设置和获取流程图的属性</p>
			   我们先介绍如何存取流程图本身的属性，设置和获取流程图属性需要一个Form，至于这个Form如何实现可以根据您的喜好，这里需要注意的是Form中输入框的name属性
			   和存取这些属性的方法。
			   <div class="highlight">
			    <textarea mode="htmlmixed">
<form id="process_form">
    <table style="width:100%;">
        <tr>
            <td style="width:150px;">流程Key：<span style='color:red;'>*</span>：</td>
            <td><input type="text" name="process_key"></td>
        </tr>
        <tr>
            <td style="width:150px;">流程名称：</td>
            <td><input type="text" name="name"></td>
        </tr>
        <tr>
            <td style="width:150px;">Name_Space：</td>
            <td><input type="text" name="process_namespace"></td>
        </tr>
        <tr>
            <td style="width:150px;">启动流程的用户：</td>
            <td><input type="text" name="candidateStarterUsers"></td>
        </tr>
        <tr>
            <td style="width:150px;">启动流程的角色：</td>
            <td><input type="text" name="candidateStarterGroups"></td>
        </tr>
        <tr>
            <td style="width:150px;">流程描述：</td>
            <td><input type="text" name="documentation"></td>
        </tr>
    </table>
</form>
			    </textarea>
			    </div>
			    <p>
			    将Form中的数据转换为Activiti所需数据：
			    </p>
			    <div class="highlight">
			    <textarea mode="javascript">
/**
* 将表单中的数据转换为流程属性
*/
function toActivity() {
  var obj = {};
  //将Form组成一个Object
  $('#process_form input').each(function() {
    var _this = $(this);
    obj[_this.attr('name')] = _this.val();
  });
  
  return obj;
}
			    </textarea>
			    </div>
			    
			    <p>
			    将Activiti中的数据转换为Form数据：
			    </p>
			    <div class="highlight">
			    <textarea mode="javascript">
/**
* 所有节点（包括流程图本身）中的raw属性，保存的就是Activiti Json Conveter要求的属性
*/
function fromActivity(activityEngine) {
  if(activityEngine) {
    var props = activityEngine.raw;
    for(var prop in props) {
      $('#process_form input[name=' + prop + ']').val(props[prop]);
    }
  }
}
			    </textarea>
			    </div>
			    
			    <p style="color:#c00;font-weight:bold;">如何设置和获取StartEvent的属性</p>
			    首先你需要一个两个form，一个form代表Start Event基本属性，另一个代表着绑定在Start Event的表单项。
			    <div class="highlight">
			    <textarea mode="htmlmixed">
<!-- Start Event属性，每一个input代表一个属性，name与Activiti Json要求一致-->
<form id="form-start-event">
   <input name="id" type="hidden" value="">
   <input name="initiator" type="hidden" value="">
   <div>
   节点名称：<input name="name" type="text" >
   </div>
   <div>
   绑定表单：<input name="formkeydefinition" type="表单Key">
   </div>
</form>

<h3>表单字段：</h3>
<form class="form-start-event-formproperties">
   <div>
   字段ID：<input name="formproperty_id" type="text" >字段名称：<input name="formproperty_name" type="text">
   </div>
 </form>
<form class="form-start-event-formproperties">
   <div>
   字段ID：<input name="formproperty_id" type="text" >字段名称：<input name="formproperty_name" type="text" >
   </div>
</form>
			    </textarea>
			    </div>
			    <p>
			    将form中的数据提取出来，组成符合Activity StartEvent 节点要求的对象格式。
			    </p>
			    <div class="highlight">
			    <textarea mode="javascript">
function toActivity() {
  var obj = {};
  //将Form组成一个Object
  $('#form-start-event input').each(function() {
    var _this = $(this);
    obj[_this.attr('name')] = _this.val();
  });
  
  //字段绑定
  var props = [];
  $('.form-start-event-formproperties').each(function() {
    var prop = {};
    $(this).find('input').each(function() {
      var _this = $(this);
      prop[_this.attr('name')] = _this.val();
    });
    props.push(prop);
  });
  
  obj.formproperties = {
      totalCount : props.length,
      items : props
  };
  
  return obj;
}
			    </textarea>
			    </div>
			    
			    
			    <p>
			    将Activity StartEvent 节点数据加载到form中。
			    </p>
			    <div class="highlight">
			    <textarea mode="javascript">
function fromActivity(node) {
  for(var prop in node.raw) {
    if(prop != 'formproperties') {
      $('#form-start-event input[name=' + prop + ']').val(node.raw[prop]);
    } else {
      for(var i = 0; i < node.raw.formproperties.items.length; i++) {
        $('input[name=formproperty_id]').get(i).value = node.raw.formproperties.items[i]['formproperty_id'];
        $('input[name=formproperty_name]').get(i).value = node.raw.formproperties.items[i]['formproperty_name'];
      }
    }
  }
}
			    </textarea>
			    
			    </div>
			    <p style="color:#c00;font-weight:bold;">如何设置和获取UserTask的属性</p>
			    <p>UserTask是最常用的节点，属性也比较复杂，好在我们不必结束这些属性的含义（看Activity文档和JsonConverter的例子），只是介绍如何将这些与Form绑定。</p>
		    </div>
			
			</div>
		</div>
	</div>
<!-- ////////////////////////Footer//////////////////////// -->
<footer class="bs-footer" role="contentinfo">
      <div class="container">
        <p>Code licensed under <a href="http://www.gnu.org/licenses/lgpl.html" target="_blank">LGPL 3</a>.</p>
        <p>XModeler版权归<a href="http://www.honqun.com/">石家庄鸿坤网络科技有限公司</a>及<a href="catstiger@gmail.com">Catstiger</a>所有。</p><p>
        </p>
        <ul class="footer-links">
          <li>当前版本： v1.0.2</li>
        </ul>
      </div>
</footer>


<script src="http://cdn.bootcss.com/holder/2.0/holder.min.js"></script>
<script src="http://cdn.bootcss.com/highlight.js/7.3/highlight.min.js"></script>
<script >hljs.initHighlightingOnLoad();</script>
<script type="text/javascript" src="js/code/codemirror.js"></script>
<script src="js/code/mode/xml/xml.js"></script>
<script src="js/code/mode/htmlmixed/htmlmixed.js"></script>
<script src="js/code/mode/javascript/javascript.js"></script>

<script type="text/javascript" src="js/application.js"></script>
<script type="text/javascript">
$(function() {
  $('textarea').each(function() {
    var mode = $(this).attr("mode");
    if(!mode) {
      mode = "xml"
    }
    
    var codeMirror = CodeMirror.fromTextArea(this, {
      mode:  mode,
      readOnly : true,
      lineNumbers : true,
      height:100
    });
  });
});
</script>
</body>
</html>